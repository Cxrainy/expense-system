# 数据库清除功能使用指南

## 🎯 功能概述

新增的数据库清除功能为管理员提供了安全的数据库管理工具，支持：

1. **完全清空数据库** - 删除所有数据和文件
2. **重置为默认状态** - 清空数据并重新创建默认配置
3. **数据库统计信息** - 实时查看各类数据的统计

## 🔐 权限要求

- **仅管理员可使用**：只有 `admin` 角色的用户才能访问此功能
- **密码验证**：执行任何危险操作都需要验证管理员密码
- **多重确认**：需要输入特定确认文本和二次确认

## 📊 数据库统计功能

### 显示内容
- 👥 **用户数量**：系统中的所有用户
- 📋 **报销记录**：所有报销申请记录
- 📎 **附件记录**：报销相关的文件附件
- 🔔 **通知数量**：系统通知记录
- 💱 **货币类型**：支持的货币种类
- 🏷️ **分类数量**：报销分类配置
- 📄 **上传文件**：物理存储的文件数量
- 💾 **文件大小**：所有文件的总大小

### 使用方法
1. 登录管理员账户
2. 导航到 **系统管理** 页面
3. 在 **数据库管理** 面板中查看统计
4. 点击 **刷新统计** 按钮更新数据

## 🗑️ 清空数据库功能

### ⚠️ 警告
此操作将**永久删除**以下所有数据：
- 所有用户账户（包括当前登录的管理员）
- 所有报销记录和审批历史
- 所有上传的文件和附件
- 所有通知记录
- 所有货币和分类配置

### 使用步骤
1. 在系统管理页面找到 **危险操作** 区域
2. 点击 **清空所有数据** 按钮
3. 在弹出的模态框中：
   - 输入确认文本：`CLEAR ALL DATA`
   - 输入当前管理员密码
4. 点击 **确认清空数据库** 按钮
5. 在最终确认对话框中点击确定

### 操作结果
- 数据库完全清空
- 上传目录中的所有文件被删除
- 用户将被自动退出登录
- 需要重新创建账户才能使用系统

## 🔄 重置为默认状态

### 功能说明
此操作会清空所有现有数据，然后重新创建以下默认配置：

#### 默认用户账户
- **管理员账户**：
  - 邮箱：`admin@company.com`
  - 密码：`admin123`
  - 角色：管理员
- **员工账户**：
  - 邮箱：`user@company.com`
  - 密码：`user123`
  - 角色：员工

#### 默认货币配置
包含10种常用货币：
- USD (美元) - 基准货币
- CNY (人民币)
- EUR (欧元)
- GBP (英镑)
- JPY (日元)
- KRW (韩元)
- HKD (港元)
- SGD (新加坡元)
- AUD (澳元)
- CAD (加元)

#### 默认分类配置
包含6种报销分类：
- 餐饮费
- 交通费
- 办公费
- 差旅费
- 通讯费
- 其他

### 使用步骤
1. 在系统管理页面找到 **危险操作** 区域
2. 点击 **重置为默认** 按钮
3. 在弹出的模态框中：
   - 输入确认文本：`RESET TO DEFAULTS`
   - 输入当前管理员密码
4. 点击 **确认重置数据库** 按钮
5. 在最终确认对话框中点击确定

### 操作结果
- 所有现有数据被清除
- 创建默认用户、货币和分类配置
- 可以使用默认账户重新登录系统

## 🛡️ 安全机制

### 多重验证
1. **权限检查**：只有管理员能看到和使用此功能
2. **确认文本**：必须准确输入特定的确认文本
3. **密码验证**：需要输入当前管理员的正确密码
4. **二次确认**：浏览器弹窗进行最终确认

### 操作审计
- 所有操作都会在后端记录时间戳
- 清除操作会返回详细的统计信息
- 建议在执行前做好数据备份

## 📱 界面特性

### 响应式设计
- 在手机和平板上均有良好显示
- 统计卡片自动适应屏幕尺寸
- 危险操作按钮在小屏幕上垂直排列

### 视觉提示
- 危险操作区域使用红色边框突出显示
- 确认文本输入有实时验证
- 只有满足所有条件时操作按钮才会启用

## 🔧 技术实现

### 后端API
- `GET /api/admin/database-stats` - 获取数据库统计
- `POST /api/admin/clear-database` - 清空数据库
- `POST /api/admin/reset-to-defaults` - 重置为默认状态

### 安全考虑
- 使用事务确保数据一致性
- 按正确顺序删除数据避免外键约束冲突
- 文件系统清理和数据库清理同步进行

## ⚡ 使用建议

### 开发环境
- 可以使用重置功能快速恢复到干净状态
- 适合测试新功能时重置数据

### 生产环境
- 执行前**务必备份数据库**
- 谨慎使用清空功能
- 优先考虑使用重置功能保留基础配置

### 紧急恢复
如果意外清空了数据：
1. 使用重置功能快速创建基础配置
2. 从备份中恢复重要数据
3. 重新配置个性化设置

## 📞 技术支持

如遇到问题：
1. 检查浏览器控制台是否有错误信息
2. 确认管理员权限和密码正确
3. 查看服务器日志获取详细错误信息

---

**⚠️ 重要提醒：此功能具有不可逆转的破坏性，请务必谨慎使用！**
