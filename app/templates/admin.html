<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á≥ªÁªüÁÆ°ÁêÜ - Êä•ÈîÄÁÆ°ÁêÜÁ≥ªÁªü</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/advanced-filters.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/user-management.css') }}">
</head>
<body class="dashboard-page">
    <!-- ‰æßËæπÊ†è -->
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2 class="sidebar-title">Êä•ÈîÄÁÆ°ÁêÜÁ≥ªÁªü</h2>
        </div>
        <div class="sidebar-nav">
            <ul class="nav-list">
                <li class="nav-item">
                    <a href="/dashboard" class="nav-link">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                            <polyline points="9,22 9,12 15,12 15,22"/>
                        </svg>
                        <span class="nav-text">‰ª™Ë°®Êùø</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/expenses" class="nav-link">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14,2 14,8 20,8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                        </svg>
                        <span class="nav-text">Êä•ÈîÄÁî≥ËØ∑</span>
                    </a>
                </li>
                {% if session.role == 'admin' %}
                <li class="nav-item">
                    <a href="/approvals" class="nav-link">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                        <span class="nav-text">ÂÆ°ÊâπÁÆ°ÁêÜ</span>
                    </a>
                </li>
                <!-- Êñ∞Â¢ûÔºöÊï∞ÊçÆÂØºÂá∫ÂÖ•Âè£ -->
                <!-- <li class="nav-item">
                    <a href="/export" class="nav-link">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v8"/>
                            <path d="M8 9l4 4 4-4"/>
                            <rect x="4" y="17" width="16" height="3" rx="1"/>
                        </svg>
                        <span class="nav-text">Êï∞ÊçÆÂØºÂá∫</span>
                    </a>
                </li> -->
                <li class="nav-item">
                    <a href="/reports" class="nav-link">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            <path d="M9 9h6v6H9z"/>
                            <path d="M9 1v2"/>
                            <path d="M15 1v2"/>
                            <path d="M9 21v2"/>
                            <path d="M15 21v2"/>
                            <path d="M1 9h2"/>
                            <path d="M1 15h2"/>
                            <path d="M21 9h2"/>
                            <path d="M21 15h2"/>
                        </svg>
                        <span class="nav-text">Êä•Ë°®ÂØºÂá∫</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="/admin" class="nav-link active">
                        <svg class="nav-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"/>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                        </svg>
                        <span class="nav-text">Á≥ªÁªüÁÆ°ÁêÜ</span>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </nav>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <div class="main-content">
        <!-- È°∂ÈÉ®ÂØºËà™ -->
        <header class="topbar">
            <div class="topbar-left">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <line x1="3" y1="12" x2="21" y2="12"/>
                        <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                </button>
            </div>

            <div class="topbar-right">
                <!-- ÈÄöÁü• -->
                <div class="notification-wrapper">
                    <button class="notification-btn" onclick="toggleNotifications()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                            <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                        </svg>
                        <span class="notification-badge" id="notificationBadge" style="display: none;">0</span>
                    </button>
                    <div class="notification-dropdown" id="notificationDropdown">
                        <div class="notification-header">
                            <h4 class="notification-title">ÈÄöÁü•Ê∂àÊÅØ</h4>
                            <a href="#" class="mark-all-read" onclick="markAllAsRead()">ÂÖ®ÈÉ®Â∑≤ËØª</a>
                        </div>
                        <div class="notification-list" id="notificationList">
                            <div class="notification-empty">
                                <div class="notification-empty-icon">üì≠</div>
                                <p>ÊöÇÊó†Êñ∞ÈÄöÁü•</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áî®Êà∑ËèúÂçï -->
                <div class="user-menu" onclick="toggleUserMenu()">
                    <div class="user-avatar">
                        {{ session.username[0] if session.username else 'U' }}
                    </div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="user-info">
                            <div class="user-name">{{ session.username }}</div>
                            <div class="user-email">{{ session.role }}</div>
                        </div>
                        <div class="dropdown-divider"></div>
                        <a href="/logout" class="dropdown-item">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                <polyline points="16,17 21,12 16,7"/>
                                <line x1="21" y1="12" x2="9" y2="12"/>
                            </svg>
                            ÈÄÄÂá∫ÁôªÂΩï
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- È°µÈù¢ÂÜÖÂÆπ -->
        <main class="page-content">
            <div class="content-header">
                <div class="header-left">
                    <h1>Á≥ªÁªüÁÆ°ÁêÜ</h1>
                    <p class="page-subtitle">ÁÆ°ÁêÜÁ≥ªÁªüÁöÑË¥ßÂ∏ÅÂíåÂàÜÁ±ªÈÖçÁΩÆ</p>
                </div>
            </div>

            <!-- ÁÆ°ÁêÜÈù¢Êùø -->
            <div class="enhanced-stats">
                <!-- Ë¥ßÂ∏ÅÁÆ°ÁêÜ -->
                <div class="stat-panel-ex">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="2" r="3"/>
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                            </svg>
                            Ë¥ßÂ∏ÅÁÆ°ÁêÜ
                        </h3>
                        <button class="btn btn-primary btn-sm" onclick="showAddCurrencyModal()">Ê∑ªÂä†Ë¥ßÂ∏Å</button>
                    </div>
                    
                    <!-- Ë¥ßÂ∏ÅÁ≠õÈÄâ -->
                    <div id="currencyFilters"></div>
                    
                    <div class="panel-content">
                        <div id="currenciesList" class="admin-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <span>Âä†ËΩΩ‰∏≠...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ÂàÜÁ±ªÁÆ°ÁêÜ -->
                <div class="stat-panel-ex">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                            </svg>
                            ÂàÜÁ±ªÁÆ°ÁêÜ
                        </h3>
                        <button class="btn btn-primary btn-sm" onclick="showAddCategoryModal()">Ê∑ªÂä†ÂàÜÁ±ª</button>
                    </div>
                    
                    <!-- ÂàÜÁ±ªÁ≠õÈÄâ -->
                    <div id="categoryFilters"></div>
                    
                    <div class="panel-content">
                        <div id="categoriesList" class="admin-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <span>Âä†ËΩΩ‰∏≠...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Áî®Êà∑ÁÆ°ÁêÜ -->
                <div class="stat-panel-ex">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/>
                                <circle cx="9" cy="7" r="4"/>
                                <path d="M22 21v-2a4 4 0 0 0-3-3.87"/>
                                <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                            </svg>
                            Áî®Êà∑ÁÆ°ÁêÜ
                        </h3>
                        <button class="btn btn-primary btn-sm" onclick="showAddUserModal()">Ê∑ªÂä†Áî®Êà∑</button>
                    </div>
                    
                    <!-- Áî®Êà∑ÊêúÁ¥¢ -->
                    <div class="search-filters">
                        <div class="search-box">
                            <input type="text" id="userSearch" placeholder="ÊêúÁ¥¢Áî®Êà∑ÂêçÊàñÈÇÆÁÆ±..." oninput="filterUsers()">
                            <button type="button" class="search-btn">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="11" cy="11" r="8"/>
                                    <path d="M21 21l-4.35-4.35"/>
                                </svg>
                            </button>
                        </div>
                        <select id="roleFilter" onchange="filterUsers()">
                            <option value="">ÊâÄÊúâËßíËâ≤</option>
                            <option value="admin">ÁÆ°ÁêÜÂëò</option>
                            <option value="user">ÊôÆÈÄöÁî®Êà∑</option>
                        </select>
                    </div>
                    
                    <div class="panel-content">
                        <div id="usersList" class="admin-list">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <span>Âä†ËΩΩ‰∏≠...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜ -->
                <div class="stat-panel-ex database-management">
                    <div class="panel-header">
                        <h3 class="panel-title">
                            <svg class="panel-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <ellipse cx="12" cy="5" rx="9" ry="3"/>
                                <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/>
                                <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/>
                            </svg>
                            Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜ
                        </h3>
                        <button class="btn btn-secondary btn-sm" onclick="refreshDatabaseStats()">Âà∑Êñ∞ÁªüËÆ°</button>
                    </div>
                    
                    <div class="panel-content">
                        <!-- Êï∞ÊçÆÂ∫ìÁªüËÆ° -->
                        <div class="database-stats" id="databaseStats">
                            <div class="loading-state">
                                <div class="loading-spinner"></div>
                                <span>Âä†ËΩΩÁªüËÆ°‰∏≠...</span>
                            </div>
                        </div>
                        
                        <!-- Êï∞ÊçÆÁÆ°ÁêÜÊìç‰Ωú -->
                        <div class="data-management-zone">
                            <h4 class="section-title">üìä Êï∞ÊçÆÁÆ°ÁêÜ</h4>
                            <p class="section-subtitle">Á≥ªÁªüÊï∞ÊçÆÂØºÂÖ•ÂíåÁÆ°ÁêÜÂäüËÉΩ</p>
                            
                            <div class="management-actions">
                                <button class="btn btn-success" onclick="importExpenseCategories()" id="importCategoriesBtn">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                        <polyline points="14,2 14,8 20,8"/>
                                        <line x1="12" y1="18" x2="12" y2="12"/>
                                        <polyline points="9,15 12,12 15,15"/>
                                    </svg>
                                    ÂØºÂÖ•Êä•ÈîÄÁ±ªÂûã
                                </button>
                                <span class="btn-help-text">ÂØºÂÖ•16ÁßçÈ¢ÑÂÆö‰πâÁöÑÊä•ÈîÄÁ±ªÂûãÔºàÂåÖÂê´ËØ¶ÁªÜÊèèËø∞Ôºâ</span>
                            </div>
                        </div>
                        
                        <!-- Âç±Èô©Êìç‰ΩúÂå∫Âüü -->
                        <div class="danger-zone">
                            <h4 class="danger-title">‚ö†Ô∏è Âç±Èô©Êìç‰Ωú</h4>
                            <p class="danger-subtitle">‰ª•‰∏ãÊìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§Êï∞ÊçÆÔºåËØ∑Ë∞®ÊÖéÊìç‰ΩúÔºÅ</p>
                            
                            <div class="danger-actions">
                                <button class="btn btn-warning" onclick="showClearDatabaseModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18"/>
                                        <path d="M19 6v14c0 1-1 2-2 2H7c0-1-1-2-1-2V6"/>
                                        <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/>
                                        <line x1="10" y1="11" x2="10" y2="17"/>
                                        <line x1="14" y1="11" x2="14" y2="17"/>
                                    </svg>
                                    Ê∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆ
                                </button>
                                
                                <button class="btn btn-primary" onclick="showResetDatabaseModal()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M1 4v6h6"/>
                                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/>
                                    </svg>
                                    ÈáçÁΩÆ‰∏∫ÈªòËÆ§
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ‰æßËæπÊ†èÈÅÆÁΩ© -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Ê∑ªÂä†Ë¥ßÂ∏ÅÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="addCurrencyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ê∑ªÂä†Ë¥ßÂ∏Å</h3>
                <button class="modal-close" onclick="closeAddCurrencyModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addCurrencyForm">
                    <div class="form-group">
                        <label class="form-label">Ë¥ßÂ∏Å‰ª£Á†Å</label>
                        <input type="text" id="currencyCode" class="form-input" placeholder="Â¶Ç: USD" required maxlength="10">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ë¥ßÂ∏ÅÂêçÁß∞</label>
                        <input type="text" id="currencyName" class="form-input" placeholder="Â¶Ç: ÁæéÂÖÉ" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ë¥ßÂ∏ÅÁ¨¶Âè∑</label>
                        <input type="text" id="currencySymbol" class="form-input" placeholder="Â¶Ç: $" required maxlength="10">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ê±áÁéá <small style="color: var(--muted-foreground);">ÔºàÂ§öÂ∞ëÂçï‰ΩçËØ•Ë¥ßÂ∏Å = 1ÁæéÂÖÉÔºâ</small></label>
                        <input type="number" id="exchangeRate" class="form-input" placeholder="7.0000" step="0.0001" min="0.0001" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddCurrencyModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="addCurrency()">Ê∑ªÂä†</button>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†ÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="addCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ê∑ªÂä†ÂàÜÁ±ª</h3>
                <button class="modal-close" onclick="closeAddCategoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addCategoryForm">
                    <div class="form-group">
                        <label class="form-label">ÂàÜÁ±ªÂêçÁß∞</label>
                        <input type="text" id="categoryName" class="form-input" placeholder="Â¶Ç: È§êÈ•ÆË¥π" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÂàÜÁ±ªÊèèËø∞</label>
                        <textarea id="categoryDescription" class="form-textarea" placeholder="ÊèèËø∞ËØ•ÂàÜÁ±ªÁöÑÁî®ÈÄî..." rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddCategoryModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="addCategory()">Ê∑ªÂä†</button>
            </div>
        </div>
    </div>

    <!-- Ê∑ªÂä†Áî®Êà∑Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Ê∑ªÂä†Áî®Êà∑</h3>
                <button class="modal-close" onclick="closeAddUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">Áî®Êà∑Âêç <span style="color: var(--destructive);">*</span></label>
                        <input type="text" id="newUserUsername" class="form-input" placeholder="Â¶Ç: zhang_san" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÈÇÆÁÆ± <span style="color: var(--destructive);">*</span></label>
                        <input type="email" id="newUserEmail" class="form-input" placeholder="Â¶Ç: zhangsan@company.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÂØÜÁ†Å <span style="color: var(--destructive);">*</span></label>
                        <input type="password" id="newUserPassword" class="form-input" placeholder="Ëá≥Â∞ë6‰ΩçÂ≠óÁ¨¶" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Á°ÆËÆ§ÂØÜÁ†Å <span style="color: var(--destructive);">*</span></label>
                        <input type="password" id="newUserPasswordConfirm" class="form-input" placeholder="ÂÜçÊ¨°ËæìÂÖ•ÂØÜÁ†Å" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ËßíËâ≤</label>
                        <select id="newUserRole" class="form-select">
                            <option value="user">ÊôÆÈÄöÁî®Êà∑</option>
                            <option value="admin">ÁÆ°ÁêÜÂëò</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeAddUserModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="addUser()">Ê∑ªÂä†Áî®Êà∑</button>
            </div>
        </div>
    </div>

    <!-- ÁºñËæëÁî®Êà∑Ê®°ÊÄÅÊ°Ü -->
    <div class="modal" id="editUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÁºñËæëÁî®Êà∑</h3>
                <button class="modal-close" onclick="closeEditUserModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <input type="hidden" id="editUserId">
                    <div class="form-group">
                        <label class="form-label">Áî®Êà∑Âêç <span style="color: var(--destructive);">*</span></label>
                        <input type="text" id="editUserUsername" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÈÇÆÁÆ± <span style="color: var(--destructive);">*</span></label>
                        <input type="email" id="editUserEmail" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Êñ∞ÂØÜÁ†Å <span style="color: var(--muted-foreground); font-size: 12px;">(ÁïôÁ©∫Âàô‰∏ç‰øÆÊîπ)</span></label>
                        <input type="password" id="editUserPassword" class="form-input" placeholder="ËæìÂÖ•Êñ∞ÂØÜÁ†ÅÊàñÁïôÁ©∫‰∏ç‰øÆÊîπ">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Á°ÆËÆ§Êñ∞ÂØÜÁ†Å</label>
                        <input type="password" id="editUserPasswordConfirm" class="form-input" placeholder="ÂÜçÊ¨°ËæìÂÖ•Êñ∞ÂØÜÁ†Å">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ËßíËâ≤</label>
                        <select id="editUserRole" class="form-select">
                            <option value="user">ÊôÆÈÄöÁî®Êà∑</option>
                            <option value="admin">ÁÆ°ÁêÜÂëò</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditUserModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="updateUser()">‰øùÂ≠ò‰øÆÊîπ</button>
            </div>
        </div>
    </div>

    <!-- ÁºñËæëË¥ßÂ∏ÅÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="editCurrencyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÁºñËæëË¥ßÂ∏Å</h3>
                <button class="modal-close" onclick="closeEditCurrencyModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editCurrencyForm">
                    <input type="hidden" id="editCurrencyId">
                    <div class="form-group">
                        <label class="form-label">Ë¥ßÂ∏Å‰ª£Á†Å</label>
                        <input type="text" id="editCurrencyCode" class="form-input" placeholder="Â¶Ç: USD" required maxlength="10" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ë¥ßÂ∏ÅÂêçÁß∞</label>
                        <input type="text" id="editCurrencyName" class="form-input" placeholder="Â¶Ç: ÁæéÂÖÉ" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ë¥ßÂ∏ÅÁ¨¶Âè∑</label>
                        <input type="text" id="editCurrencySymbol" class="form-input" placeholder="Â¶Ç: $" required maxlength="10">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ê±áÁéá <small style="color: var(--muted-foreground);">ÔºàÂ§öÂ∞ëÂçï‰ΩçËØ•Ë¥ßÂ∏Å = 1ÁæéÂÖÉÔºâ</small></label>
                        <input type="number" id="editExchangeRate" class="form-input" placeholder="7.0000" step="0.0001" min="0.0001" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditCurrencyModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="updateCurrency()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- ÁºñËæëÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="editCategoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">ÁºñËæëÂàÜÁ±ª</h3>
                <button class="modal-close" onclick="closeEditCategoryModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="editCategoryForm">
                    <input type="hidden" id="editCategoryId">
                    <div class="form-group">
                        <label class="form-label">ÂàÜÁ±ªÂêçÁß∞</label>
                        <input type="text" id="editCategoryName" class="form-input" placeholder="Â¶Ç: È§êÈ•ÆË¥π" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÂàÜÁ±ªÊèèËø∞</label>
                        <textarea id="editCategoryDescription" class="form-textarea" placeholder="ÊèèËø∞ËØ•ÂàÜÁ±ªÁöÑÁî®ÈÄî..." rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEditCategoryModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="updateCategory()">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Ê∏ÖÁ©∫Êï∞ÊçÆÂ∫ìÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="clearDatabaseModal">
        <div class="modal-content modal-danger">
            <div class="modal-header">
                <h3 class="modal-title">‚ö†Ô∏è Ê∏ÖÁ©∫Êï∞ÊçÆÂ∫ì</h3>
                <button class="modal-close" onclick="closeClearDatabaseModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-danger">
                    <strong>Ë≠¶ÂëäÔºö</strong>Ê≠§Êìç‰ΩúÂ∞ÜÊ∞∏‰πÖÂà†Èô§ÊâÄÊúâÊï∞ÊçÆÔºåÂåÖÊã¨Ôºö
                    <ul>
                        <li>ÊâÄÊúâÁî®Êà∑Ë¥¶Êà∑</li>
                        <li>ÊâÄÊúâÊä•ÈîÄËÆ∞ÂΩï</li>
                        <li>ÊâÄÊúâ‰∏ä‰º†Êñá‰ª∂</li>
                        <li>ÊâÄÊúâÈÄöÁü•ËÆ∞ÂΩï</li>
                        <li>ÊâÄÊúâË¥ßÂ∏ÅÂíåÂàÜÁ±ªÈÖçÁΩÆ</li>
                    </ul>
                    <p><strong>Ê≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºÅ</strong></p>
                </div>

                <form id="clearDatabaseForm">
                    <div class="form-group">
                        <label class="form-label">Á°ÆËÆ§ÊñáÊú¨</label>
                        <input type="text" id="clearConfirmation" class="form-input" 
                               placeholder="ËØ∑ËæìÂÖ•: CLEAR ALL DATA" required>
                        <small class="form-help">ÂøÖÈ°ªÂáÜÁ°ÆËæìÂÖ•Á°ÆËÆ§ÊñáÊú¨ÊâçËÉΩÊâßË°åÊìç‰Ωú</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ÁÆ°ÁêÜÂëòÂØÜÁ†Å</label>
                        <input type="password" id="clearAdminPassword" class="form-input" 
                               placeholder="ËæìÂÖ•ÊÇ®ÁöÑÁÆ°ÁêÜÂëòÂØÜÁ†Å" required>
                        <small class="form-help">ÈúÄË¶ÅÈ™åËØÅÁÆ°ÁêÜÂëòË∫´‰ªΩ</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeClearDatabaseModal()">ÂèñÊ∂à</button>
                <button class="btn btn-danger" onclick="executeClearDatabase()" id="clearDatabaseBtn" disabled>
                    Á°ÆËÆ§Ê∏ÖÁ©∫Êï∞ÊçÆÂ∫ì
                </button>
            </div>
        </div>
    </div>

    <!-- ÈáçÁΩÆÊï∞ÊçÆÂ∫ìÊ®°ÊÄÅÊ°Ü -->
    <div class="modal" id="resetDatabaseModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">üîÑ ÈáçÁΩÆÊï∞ÊçÆÂ∫ì</h3>
                <button class="modal-close" onclick="closeResetDatabaseModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <strong>Ê≥®ÊÑèÔºö</strong>Ê≠§Êìç‰ΩúÂ∞ÜÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂπ∂ÈáçÊñ∞ÂàõÂª∫ÈªòËÆ§ÈÖçÁΩÆÔºö
                    <ul>
                        <li>ÈªòËÆ§ÁÆ°ÁêÜÂëòË¥¶Êà∑Ôºöadmin@company.com</li>
                        <li>ÈªòËÆ§ÂëòÂ∑•Ë¥¶Êà∑Ôºöuser@company.com</li>
                        <li>10ÁßçÂ∏∏Áî®Ë¥ßÂ∏ÅÈÖçÁΩÆ</li>
                        <li>6ÁßçÊä•ÈîÄÂàÜÁ±ªÈÖçÁΩÆ</li>
                    </ul>
                    <p>Áé∞ÊúâÊï∞ÊçÆÂ∞ÜË¢´ÂÆåÂÖ®Ê∏ÖÈô§„ÄÇ</p>
                </div>

                <form id="resetDatabaseForm">
                    <div class="form-group">
                        <label class="form-label">Á°ÆËÆ§ÊñáÊú¨</label>
                        <input type="text" id="resetConfirmation" class="form-input" 
                               placeholder="ËØ∑ËæìÂÖ•: RESET TO DEFAULTS" required>
                        <small class="form-help">ÂøÖÈ°ªÂáÜÁ°ÆËæìÂÖ•Á°ÆËÆ§ÊñáÊú¨ÊâçËÉΩÊâßË°åÊìç‰Ωú</small>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">ÁÆ°ÁêÜÂëòÂØÜÁ†Å</label>
                        <input type="password" id="resetAdminPassword" class="form-input" 
                               placeholder="ËæìÂÖ•ÊÇ®ÁöÑÁÆ°ÁêÜÂëòÂØÜÁ†Å" required>
                        <small class="form-help">ÈúÄË¶ÅÈ™åËØÅÁÆ°ÁêÜÂëòË∫´‰ªΩ</small>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeResetDatabaseModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="executeResetDatabase()" id="resetDatabaseBtn" disabled>
                    Á°ÆËÆ§ÈáçÁΩÆÊï∞ÊçÆÂ∫ì
                </button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/utils.js') }}"></script>
    <script src="{{ url_for('static', filename='js/notification.js') }}"></script>
    <script src="{{ url_for('static', filename='js/advanced-filters.js') }}"></script>
    <script>
        let currencies = [];
        let filteredCurrencies = [];
        let currencyFilters = null;
        
        let categories = [];
        let filteredCategories = [];
        let categoryFilters = null;

        // ‰æßËæπÊ†èÂàáÊç¢
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar.classList.contains('open')) {
                sidebar.classList.remove('open');
                overlay.classList.remove('active');
            } else {
                sidebar.classList.add('open');
                overlay.classList.add('active');
            }
        }
        
        // Áî®Êà∑ËèúÂçïÂàáÊç¢
        function toggleUserMenu() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        }

        // ÂàùÂßãÂåñË¥ßÂ∏ÅÁ≠õÈÄâ
        function initCurrencyFilters() {
            currencyFilters = new AdvancedFilters('currencyFilters', {
                title: 'Ë¥ßÂ∏ÅÁ≠õÈÄâ',
                collapsed: true,
                showQuickFilters: true,
                showSearch: true,
                fields: [
                    {
                        key: 'status',
                        label: 'Áä∂ÊÄÅ',
                        type: 'select',
                        options: [
                            { value: '', label: 'ÂÖ®ÈÉ®Áä∂ÊÄÅ' },
                            { value: 'active', label: 'Â∑≤ÂêØÁî®' },
                            { value: 'inactive', label: 'Â∑≤Á¶ÅÁî®' }
                        ]
                    },
                    {
                        key: 'exchangeRate',
                        label: 'Ê±áÁéáËåÉÂõ¥',
                        type: 'amountRange'
                    }
                ],
                quickFilters: [
                    { label: 'Â∑≤ÂêØÁî®', filters: { status: 'active' } },
                    { label: 'Â∑≤Á¶ÅÁî®', filters: { status: 'inactive' } },
                    { label: 'È´òÊ±áÁéá', filters: { exchangeRate: { min: '5' } } }
                ],
                onFilterChange: (filters) => {
                    applyCurrencyFilters(filters);
                }
            });
        }

        // ÂàùÂßãÂåñÂàÜÁ±ªÁ≠õÈÄâ
        function initCategoryFilters() {
            categoryFilters = new AdvancedFilters('categoryFilters', {
                title: 'ÂàÜÁ±ªÁ≠õÈÄâ',
                collapsed: true,
                showQuickFilters: true,
                showSearch: true,
                fields: [
                    {
                        key: 'status',
                        label: 'Áä∂ÊÄÅ',
                        type: 'select',
                        options: [
                            { value: '', label: 'ÂÖ®ÈÉ®Áä∂ÊÄÅ' },
                            { value: 'active', label: 'Â∑≤ÂêØÁî®' },
                            { value: 'inactive', label: 'Â∑≤Á¶ÅÁî®' }
                        ]
                    }
                ],
                quickFilters: [
                    { label: 'Â∑≤ÂêØÁî®', filters: { status: 'active' } },
                    { label: 'Â∑≤Á¶ÅÁî®', filters: { status: 'inactive' } }
                ],
                onFilterChange: (filters) => {
                    applyCategoryFilters(filters);
                }
            });
        }

        // Â∫îÁî®Ë¥ßÂ∏ÅÁ≠õÈÄâ
        function applyCurrencyFilters(filters) {
            filteredCurrencies = currencies.filter(currency => {
                // Áä∂ÊÄÅÁ≠õÈÄâ
                if (filters.status) {
                    const isActive = currency.is_active;
                    if (filters.status === 'active' && !isActive) return false;
                    if (filters.status === 'inactive' && isActive) return false;
                }
                
                // Ê±áÁéáËåÉÂõ¥Á≠õÈÄâ
                if (filters.exchangeRate) {
                    const rate = parseFloat(currency.exchange_rate);
                    if (filters.exchangeRate.min !== undefined && rate < parseFloat(filters.exchangeRate.min)) {
                        return false;
                    }
                    if (filters.exchangeRate.max !== undefined && rate > parseFloat(filters.exchangeRate.max)) {
                        return false;
                    }
                }
                
                // ÊêúÁ¥¢Á≠õÈÄâ
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    const searchFields = [
                        currency.name,
                        currency.code,
                        currency.symbol
                    ].filter(Boolean).join(' ').toLowerCase();
                    
                    if (!searchFields.includes(searchTerm)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            renderCurrencies(filteredCurrencies);
        }

        // Â∫îÁî®ÂàÜÁ±ªÁ≠õÈÄâ
        function applyCategoryFilters(filters) {
            filteredCategories = categories.filter(category => {
                // Áä∂ÊÄÅÁ≠õÈÄâ
                if (filters.status) {
                    const isActive = category.is_active;
                    if (filters.status === 'active' && !isActive) return false;
                    if (filters.status === 'inactive' && isActive) return false;
                }
                
                // ÊêúÁ¥¢Á≠õÈÄâ
                if (filters.search) {
                    const searchTerm = filters.search.toLowerCase();
                    const searchFields = [
                        category.name,
                        category.description
                    ].filter(Boolean).join(' ').toLowerCase();
                    
                    if (!searchFields.includes(searchTerm)) {
                        return false;
                    }
                }
                
                return true;
            });
            
            renderCategories(filteredCategories);
        }

        // Âä†ËΩΩË¥ßÂ∏ÅÂàóË°®
        async function loadCurrencies() {
            const container = document.getElementById('currenciesList');
            
            try {
                currencies = await api.get('/api/admin/currencies');
                filteredCurrencies = currencies;
                
                if (currencies.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†Ë¥ßÂ∏ÅÈÖçÁΩÆ</p></div>';
                    return;
                }
                
                renderCurrencies(currencies);
                
            } catch (error) {
                console.error('Âä†ËΩΩË¥ßÂ∏ÅÂàóË°®Â§±Ë¥•:', error);
                container.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•</p></div>';
            }
        }

        // Ê∏≤ÊüìË¥ßÂ∏ÅÂàóË°®
        function renderCurrencies(data) {
            const container = document.getElementById('currenciesList');
            
            const html = data.map(currency => `
                <div class="admin-item ${!currency.is_active ? 'disabled' : ''}">
                    <div class="admin-item-info">
                        <h4>${currency.name} (${currency.code})</h4>
                        <p>Á¨¶Âè∑: ${currency.symbol} | Ê±áÁéá: ${currency.exchange_rate}</p>
                        ${!currency.is_active ? '<p class="text-warning">‚ö†Ô∏è Ê≠§Ë¥ßÂ∏ÅÂ∑≤Ë¢´Á¶ÅÁî®</p>' : ''}
                    </div>
                    <div class="admin-item-actions">
                        ${currency.is_active ? 
                            `<button class="btn btn-secondary btn-sm" onclick="editCurrency(${currency.id})">ÁºñËæë</button>
                             <button class="btn btn-destructive btn-sm" onclick="deleteCurrency(${currency.id})">Âà†Èô§</button>` :
                            `<button class="btn btn-primary btn-sm" onclick="restoreCurrency(${currency.id})">ÊÅ¢Â§ç</button>
                             <button class="btn btn-secondary btn-sm" onclick="editCurrency(${currency.id})">Êü•Áúã</button>`
                        }
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Âä†ËΩΩÂàÜÁ±ªÂàóË°®
        async function loadCategories() {
            const container = document.getElementById('categoriesList');
            
            try {
                categories = await api.get('/api/admin/categories');
                filteredCategories = categories;
                
                if (categories.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†ÂàÜÁ±ªÈÖçÁΩÆ</p></div>';
                    return;
                }
                
                renderCategories(categories);
                
            } catch (error) {
                console.error('Âä†ËΩΩÂàÜÁ±ªÂàóË°®Â§±Ë¥•:', error);
                container.innerHTML = '<div class="empty-state"><p>Âä†ËΩΩÂ§±Ë¥•</p></div>';
            }
        }

        // Ê∏≤ÊüìÂàÜÁ±ªÂàóË°®
        function renderCategories(data) {
            const container = document.getElementById('categoriesList');
            
            const html = data.map(category => `
                <div class="admin-item ${!category.is_active ? 'disabled' : ''}">
                    <div class="admin-item-info">
                        <h4>${category.name}</h4>
                        <p>${category.description || 'Êó†ÊèèËø∞'}</p>
                        ${!category.is_active ? '<p class="text-warning">‚ö†Ô∏è Ê≠§ÂàÜÁ±ªÂ∑≤Ë¢´Á¶ÅÁî®</p>' : ''}
                    </div>
                    <div class="admin-item-actions">
                        ${category.is_active ? 
                            `<button class="btn btn-secondary btn-sm" onclick="editCategory(${category.id})">ÁºñËæë</button>
                             <button class="btn btn-destructive btn-sm" onclick="deleteCategory(${category.id})">Âà†Èô§</button>` :
                            `<button class="btn btn-primary btn-sm" onclick="restoreCategory(${category.id})">ÊÅ¢Â§ç</button>
                             <button class="btn btn-secondary btn-sm" onclick="editCategory(${category.id})">Êü•Áúã</button>`
                        }
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // ÊòæÁ§∫Ê∑ªÂä†Ë¥ßÂ∏ÅÊ®°ÊÄÅÊ°Ü
        function showAddCurrencyModal() {
            document.getElementById('addCurrencyModal').classList.add('show');
        }

        // ÂÖ≥Èó≠Ê∑ªÂä†Ë¥ßÂ∏ÅÊ®°ÊÄÅÊ°Ü
        function closeAddCurrencyModal() {
            document.getElementById('addCurrencyModal').classList.remove('show');
            document.getElementById('addCurrencyForm').reset();
        }

        // Ê∑ªÂä†Ë¥ßÂ∏Å
        async function addCurrency() {
            const code = document.getElementById('currencyCode').value.toUpperCase();
            const name = document.getElementById('currencyName').value;
            const symbol = document.getElementById('currencySymbol').value;
            const exchangeRate = document.getElementById('exchangeRate').value;
            
            if (!code || !name || !symbol || !exchangeRate) {
                utils.showMessage('ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ', 'error');
                return;
            }
            
            try {
                await api.post('/api/admin/currencies', {
                    code, name, symbol, exchange_rate: parseFloat(exchangeRate)
                });
                
                utils.showMessage('Ë¥ßÂ∏ÅÊ∑ªÂä†ÊàêÂäü', 'success');
                closeAddCurrencyModal();
                loadCurrencies();
                
            } catch (error) {
                utils.showMessage(error.message || 'Ê∑ªÂä†Â§±Ë¥•', 'error');
            }
        }

        // Âà†Èô§Ë¥ßÂ∏Å
        async function deleteCurrency(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™Ë¥ßÂ∏ÅÂêóÔºüÂ¶ÇÊûúÊúâÁõ∏ÂÖ≥Êä•ÈîÄËÆ∞ÂΩïÔºåÂ∞ÜË¢´Á¶ÅÁî®ËÄå‰∏çÊòØÂà†Èô§„ÄÇ')) {
                return;
            }
            
            try {
                const result = await api.delete(`/api/admin/currencies/${id}`);
                utils.showMessage(result.message, 'success');
                loadCurrencies();
                
            } catch (error) {
                utils.showMessage(error.message || 'Âà†Èô§Â§±Ë¥•', 'error');
            }
        }

        // ÊòæÁ§∫Ê∑ªÂä†ÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü
        function showAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.add('show');
        }

        // ÂÖ≥Èó≠Ê∑ªÂä†ÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü
        function closeAddCategoryModal() {
            document.getElementById('addCategoryModal').classList.remove('show');
            document.getElementById('addCategoryForm').reset();
        }

        // Ê∑ªÂä†ÂàÜÁ±ª
        async function addCategory() {
            const name = document.getElementById('categoryName').value;
            const description = document.getElementById('categoryDescription').value;
            
            if (!name) {
                utils.showMessage('ËØ∑Â°´ÂÜôÂàÜÁ±ªÂêçÁß∞', 'error');
                return;
            }
            
            try {
                await api.post('/api/admin/categories', {
                    name, description
                });
                
                utils.showMessage('ÂàÜÁ±ªÊ∑ªÂä†ÊàêÂäü', 'success');
                closeAddCategoryModal();
                loadCategories();
                
            } catch (error) {
                utils.showMessage(error.message || 'Ê∑ªÂä†Â§±Ë¥•', 'error');
            }
        }

        // Âà†Èô§ÂàÜÁ±ª
        async function deleteCategory(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÂà†Èô§Ëøô‰∏™ÂàÜÁ±ªÂêóÔºüÂ¶ÇÊûúÊúâÁõ∏ÂÖ≥Êä•ÈîÄËÆ∞ÂΩïÔºåÂ∞ÜË¢´Á¶ÅÁî®ËÄå‰∏çÊòØÂà†Èô§„ÄÇ')) {
                return;
            }
            
            try {
                const result = await api.delete(`/api/admin/categories/${id}`);
                utils.showMessage(result.message, 'success');
                loadCategories();
                
            } catch (error) {
                utils.showMessage(error.message || 'Âà†Èô§Â§±Ë¥•', 'error');
            }
        }

        // ÊÅ¢Â§çË¥ßÂ∏Å
        async function restoreCurrency(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÊÅ¢Â§çËøô‰∏™Ë¥ßÂ∏ÅÂêóÔºü')) {
                return;
            }
            
            try {
                const result = await api.post(`/api/admin/currencies/${id}/restore`);
                utils.showMessage(result.message, 'success');
                loadCurrencies();
                
            } catch (error) {
                utils.showMessage(error.message || 'ÊÅ¢Â§çÂ§±Ë¥•', 'error');
            }
        }

        // ÊÅ¢Â§çÂàÜÁ±ª
        async function restoreCategory(id) {
            if (!confirm('Á°ÆÂÆöË¶ÅÊÅ¢Â§çËøô‰∏™ÂàÜÁ±ªÂêóÔºü')) {
                return;
            }
            
            try {
                const result = await api.post(`/api/admin/categories/${id}/restore`);
                utils.showMessage(result.message, 'success');
                loadCategories();
                
            } catch (error) {
                utils.showMessage(error.message || 'ÊÅ¢Â§çÂ§±Ë¥•', 'error');
            }
        }

        // ÁºñËæëË¥ßÂ∏Å
        async function editCurrency(id) {
            try {
                const currency = currencies.find(c => c.id === id);
                
                if (!currency) {
                    utils.showMessage('Ë¥ßÂ∏Å‰∏çÂ≠òÂú®', 'error');
                    return;
                }
                
                // Â°´ÂÖÖË°®ÂçïÊï∞ÊçÆ
                document.getElementById('editCurrencyId').value = currency.id;
                document.getElementById('editCurrencyCode').value = currency.code;
                document.getElementById('editCurrencyName').value = currency.name;
                document.getElementById('editCurrencySymbol').value = currency.symbol;
                document.getElementById('editExchangeRate').value = currency.exchange_rate;
                
                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                document.getElementById('editCurrencyModal').classList.add('show');
                
            } catch (error) {
                utils.showMessage('Âä†ËΩΩË¥ßÂ∏Å‰ø°ÊÅØÂ§±Ë¥•', 'error');
            }
        }

        // ÂÖ≥Èó≠ÁºñËæëË¥ßÂ∏ÅÊ®°ÊÄÅÊ°Ü
        function closeEditCurrencyModal() {
            document.getElementById('editCurrencyModal').classList.remove('show');
            document.getElementById('editCurrencyForm').reset();
        }

        // Êõ¥Êñ∞Ë¥ßÂ∏Å
        async function updateCurrency() {
            const id = document.getElementById('editCurrencyId').value;
            const name = document.getElementById('editCurrencyName').value;
            const symbol = document.getElementById('editCurrencySymbol').value;
            const exchangeRate = document.getElementById('editExchangeRate').value;
            
            if (!name || !symbol || !exchangeRate) {
                utils.showMessage('ËØ∑Â°´ÂÜôÊâÄÊúâÂ≠óÊÆµ', 'error');
                return;
            }
            
            try {
                await api.put(`/api/admin/currencies/${id}`, {
                    name, symbol, exchange_rate: parseFloat(exchangeRate)
                });
                
                utils.showMessage('Ë¥ßÂ∏ÅÊõ¥Êñ∞ÊàêÂäü', 'success');
                closeEditCurrencyModal();
                loadCurrencies();
                
            } catch (error) {
                utils.showMessage(error.message || 'Êõ¥Êñ∞Â§±Ë¥•', 'error');
            }
        }

        // ÁºñËæëÂàÜÁ±ª
        async function editCategory(id) {
            try {
                const category = categories.find(c => c.id === id);
                
                if (!category) {
                    utils.showMessage('ÂàÜÁ±ª‰∏çÂ≠òÂú®', 'error');
                    return;
                }
                
                // Â°´ÂÖÖË°®ÂçïÊï∞ÊçÆ
                document.getElementById('editCategoryId').value = category.id;
                document.getElementById('editCategoryName').value = category.name;
                document.getElementById('editCategoryDescription').value = category.description || '';
                
                // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
                document.getElementById('editCategoryModal').classList.add('show');
                
            } catch (error) {
                utils.showMessage('Âä†ËΩΩÂàÜÁ±ª‰ø°ÊÅØÂ§±Ë¥•', 'error');
            }
        }

        // ÂÖ≥Èó≠ÁºñËæëÂàÜÁ±ªÊ®°ÊÄÅÊ°Ü
        function closeEditCategoryModal() {
            document.getElementById('editCategoryModal').classList.remove('show');
            document.getElementById('editCategoryForm').reset();
        }

        // Êõ¥Êñ∞ÂàÜÁ±ª
        async function updateCategory() {
            const id = document.getElementById('editCategoryId').value;
            const name = document.getElementById('editCategoryName').value;
            const description = document.getElementById('editCategoryDescription').value;
            
            if (!name) {
                utils.showMessage('ËØ∑Â°´ÂÜôÂàÜÁ±ªÂêçÁß∞', 'error');
                return;
            }
            
            try {
                await api.put(`/api/admin/categories/${id}`, {
                    name, description
                });
                
                utils.showMessage('ÂàÜÁ±ªÊõ¥Êñ∞ÊàêÂäü', 'success');
                closeEditCategoryModal();
                loadCategories();
                
            } catch (error) {
                utils.showMessage(error.message || 'Êõ¥Êñ∞Â§±Ë¥•', 'error');
            }
        }

        // Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜÂäüËÉΩ
        let databaseStats = {};

        // ÂØºÂÖ•Êä•ÈîÄÁ±ªÂûã
        async function importExpenseCategories() {
            const button = document.getElementById('importCategoriesBtn');
            const originalText = button.innerHTML;
            
            try {
                // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
                button.disabled = true;
                button.innerHTML = `
                    <div class="spinner-border spinner-border-sm" role="status">
                        <span class="sr-only">Loading...</span>
                    </div>
                    ÂØºÂÖ•‰∏≠...
                `;
                
                const response = await api.post('/api/admin/import-categories');
                
                // ÊòæÁ§∫ÊàêÂäüÊ∂àÊÅØ
                utils.showMessage(
                    `ÂØºÂÖ•ÊàêÂäüÔºÅÊñ∞Â¢û ${response.imported} ‰∏™ÔºåÊõ¥Êñ∞ ${response.updated} ‰∏™ÔºåË∑≥Ëøá ${response.skipped} ‰∏™`, 
                    'success'
                );
                
                // Âà∑Êñ∞Êï∞ÊçÆÂ∫ìÁªüËÆ°
                await refreshDatabaseStats();
                
            } catch (error) {
                utils.showMessage('ÂØºÂÖ•Â§±Ë¥•: ' + error.message, 'error');
            } finally {
                // ÊÅ¢Â§çÊåâÈíÆÁä∂ÊÄÅ
                button.disabled = false;
                button.innerHTML = originalText;
            }
        }

        // Âä†ËΩΩÊï∞ÊçÆÂ∫ìÁªüËÆ°‰ø°ÊÅØ
        async function refreshDatabaseStats() {
            try {
                const response = await api.get('/api/admin/database-stats');
                databaseStats = response.stats;
                renderDatabaseStats();
            } catch (error) {
                utils.showMessage('Âä†ËΩΩÁªüËÆ°‰ø°ÊÅØÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Ê∏≤ÊüìÊï∞ÊçÆÂ∫ìÁªüËÆ°‰ø°ÊÅØ
        function renderDatabaseStats() {
            const container = document.getElementById('databaseStats');
            const formatFileSize = (bytes) => {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            };

            container.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-icon">üë•</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.users || 0}</div>
                            <div class="stat-label">Áî®Êà∑</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üìã</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.expenses || 0}</div>
                            <div class="stat-label">Êä•ÈîÄËÆ∞ÂΩï</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üìé</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.expense_files || 0}</div>
                            <div class="stat-label">ÈôÑ‰ª∂ËÆ∞ÂΩï</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üîî</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.notifications || 0}</div>
                            <div class="stat-label">ÈÄöÁü•</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üí±</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.currencies || 0}</div>
                            <div class="stat-label">Ë¥ßÂ∏ÅÁ±ªÂûã</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üè∑Ô∏è</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.categories || 0}</div>
                            <div class="stat-label">ÂàÜÁ±ª</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üìÑ</div>
                        <div class="stat-content">
                            <div class="stat-value">${databaseStats.uploaded_files || 0}</div>
                            <div class="stat-label">‰∏ä‰º†Êñá‰ª∂</div>
                        </div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-icon">üíæ</div>
                        <div class="stat-content">
                            <div class="stat-value">${formatFileSize(databaseStats.total_file_size || 0)}</div>
                            <div class="stat-label">Êñá‰ª∂Â§ßÂ∞è</div>
                        </div>
                    </div>
                </div>
                <div class="stats-summary">
                    <p><strong>ÊÄªËÆ∞ÂΩïÊï∞Ôºö</strong>${databaseStats.total_records || 0} Êù°</p>
                    <p><small>ÊúÄÂêéÊõ¥Êñ∞Ôºö${new Date().toLocaleString()}</small></p>
                </div>
            `;
        }

        // ÊòæÁ§∫Ê∏ÖÁ©∫Êï∞ÊçÆÂ∫ìÊ®°ÊÄÅÊ°Ü
        function showClearDatabaseModal() {
            document.getElementById('clearDatabaseModal').classList.add('show');
        }

        // ÂÖ≥Èó≠Ê∏ÖÁ©∫Êï∞ÊçÆÂ∫ìÊ®°ÊÄÅÊ°Ü
        function closeClearDatabaseModal() {
            document.getElementById('clearDatabaseModal').classList.remove('show');
            document.getElementById('clearDatabaseForm').reset();
            document.getElementById('clearDatabaseBtn').disabled = true;
        }

        // ÊòæÁ§∫ÈáçÁΩÆÊï∞ÊçÆÂ∫ìÊ®°ÊÄÅÊ°Ü
        function showResetDatabaseModal() {
            document.getElementById('resetDatabaseModal').classList.add('show');
        }

        // ÂÖ≥Èó≠ÈáçÁΩÆÊï∞ÊçÆÂ∫ìÊ®°ÊÄÅÊ°Ü
        function closeResetDatabaseModal() {
            document.getElementById('resetDatabaseModal').classList.remove('show');
            document.getElementById('resetDatabaseForm').reset();
            document.getElementById('resetDatabaseBtn').disabled = true;
        }

        // ÊâßË°åÊ∏ÖÁ©∫Êï∞ÊçÆÂ∫ì
        async function executeClearDatabase() {
            const confirmation = document.getElementById('clearConfirmation').value;
            const password = document.getElementById('clearAdminPassword').value;

            if (confirmation !== 'CLEAR ALL DATA') {
                utils.showMessage('Á°ÆËÆ§ÊñáÊú¨‰∏çÊ≠£Á°Æ', 'error');
                return;
            }

            if (!password) {
                utils.showMessage('ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†Å', 'error');
                return;
            }

            try {
                const confirmAgain = confirm('ÊúÄÂêéÁ°ÆËÆ§ÔºöÊÇ®Á°ÆÂÆöË¶ÅÊ∏ÖÁ©∫ÊâÄÊúâÊï∞ÊçÆÂêóÔºüÊ≠§Êìç‰ΩúÊó†Ê≥ïÊí§ÈîÄÔºÅ');
                if (!confirmAgain) return;

                const response = await api.post('/api/admin/clear-database', {
                    confirmation: confirmation,
                    admin_password: password
                });

                utils.showMessage('Êï∞ÊçÆÂ∫ìÂ∑≤ÂÆåÂÖ®Ê∏ÖÁ©∫', 'success');
                closeClearDatabaseModal();
                
                // ÊòæÁ§∫Ê∏ÖÁ©∫ÁªìÊûú
                setTimeout(() => {
                    alert('Ê∏ÖÁ©∫ÂÆåÊàêÔºÅËØ¶ÊÉÖÔºö\\n' + response.clear_results.join('\\n'));
                    // È°µÈù¢Â∞Ü‰ºöÂõ†‰∏∫sessionÂ§±ÊïàËÄåÈáçÂÆöÂêëÂà∞ÁôªÂΩïÈ°µ
                    window.location.href = '/';
                }, 1000);

            } catch (error) {
                utils.showMessage('Ê∏ÖÁ©∫Â§±Ë¥•: ' + error.message, 'error');
            }
        }

        // ÊâßË°åÈáçÁΩÆÊï∞ÊçÆÂ∫ì
        async function executeResetDatabase() {
            const confirmation = document.getElementById('resetConfirmation').value;
            const password = document.getElementById('resetAdminPassword').value;

            if (confirmation !== 'RESET TO DEFAULTS') {
                utils.showMessage('Á°ÆËÆ§ÊñáÊú¨‰∏çÊ≠£Á°Æ', 'error');
                return;
            }

            if (!password) {
                utils.showMessage('ËØ∑ËæìÂÖ•ÁÆ°ÁêÜÂëòÂØÜÁ†Å', 'error');
                return;
            }

            try {
                const confirmAgain = confirm('ÊúÄÂêéÁ°ÆËÆ§ÔºöÊÇ®Á°ÆÂÆöË¶ÅÈáçÁΩÆÊï∞ÊçÆÂ∫ìÂà∞ÈªòËÆ§Áä∂ÊÄÅÂêóÔºü');
                if (!confirmAgain) return;

                const response = await api.post('/api/admin/reset-to-defaults', {
                    confirmation: confirmation,
                    admin_password: password
                });

                utils.showMessage('Êï∞ÊçÆÂ∫ìÂ∑≤ÈáçÁΩÆ‰∏∫ÈªòËÆ§Áä∂ÊÄÅ', 'success');
                closeResetDatabaseModal();
                
                setTimeout(() => {
                    alert('ÈáçÁΩÆÂÆåÊàêÔºÅÂ∑≤ÂàõÂª∫ÈªòËÆ§ÁÆ°ÁêÜÂëòÂíåÂëòÂ∑•Ë¥¶Êà∑Ôºå‰ª•ÂèäÂü∫Á°ÄÈÖçÁΩÆÊï∞ÊçÆ„ÄÇ');
                    // ÈáçÊñ∞ÁôªÂΩï
                    window.location.href = '/';
                }, 1000);

            } catch (error) {
                utils.showMessage('ÈáçÁΩÆÂ§±Ë¥•: ' + error.message, 'error');
            }
        }

        // Áî®Êà∑ÁÆ°ÁêÜÂäüËÉΩ
        let users = [];
        let filteredUsers = [];
        let currentUserId = {{ session.user_id if session.user_id else 'null' }};

        // Âä†ËΩΩÁî®Êà∑ÂàóË°®
        async function loadUsers() {
            const container = document.getElementById('usersList');
            
            try {
                users = await api.get('/api/admin/users');
                filteredUsers = users;
                
                if (users.length === 0) {
                    container.innerHTML = '<div class="empty-state"><p>ÊöÇÊó†Áî®Êà∑</p></div>';
                    return;
                }
                
                renderUsers(filteredUsers);
                
            } catch (error) {
                console.error('Âä†ËΩΩÁî®Êà∑Â§±Ë¥•:', error);
                container.innerHTML = '<div class="empty-state error"><p>Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï</p></div>';
            }
        }

        // Ê∏≤ÊüìÁî®Êà∑ÂàóË°®
        function renderUsers(userList) {
            const container = document.getElementById('usersList');
            
            const html = userList.map(user => {
                const roleIcon = user.role === 'admin' ? 'üëë' : 'üë§';
                const roleName = user.role === 'admin' ? 'ÁÆ°ÁêÜÂëò' : 'ÊôÆÈÄöÁî®Êà∑';
                const roleClass = user.role === 'admin' ? 'admin' : 'user';
                
                return `
                    <div class="admin-item">
                        <div class="item-info">
                            <div class="item-main">
                                <span class="item-name">${roleIcon} ${user.username}</span>
                                <div class="item-details">
                                    <span class="item-detail">${user.email}</span>
                                    <span class="badge badge-${roleClass}">${roleName}</span>
                                </div>
                            </div>
                        </div>
                        <div class="item-actions">
                            <button class="btn btn-sm btn-outline" onclick="editUser(${user.id})">ÁºñËæë</button>
                            ${user.id !== ${JSON.stringify(currentUserId)} ? `<button class="btn btn-sm btn-destructive" onclick="deleteUser(${user.id}, '${user.username}')">Âà†Èô§</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        // Á≠õÈÄâÁî®Êà∑
        function filterUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            
            filteredUsers = users.filter(user => {
                const matchesSearch = user.username.toLowerCase().includes(searchTerm) || 
                                    user.email.toLowerCase().includes(searchTerm);
                const matchesRole = !roleFilter || user.role === roleFilter;
                
                return matchesSearch && matchesRole;
            });
            
            renderUsers(filteredUsers);
        }

        // ÊòæÁ§∫Ê∑ªÂä†Áî®Êà∑Ê®°ÊÄÅÊ°Ü
        function showAddUserModal() {
            document.getElementById('addUserModal').classList.add('show');
        }

        // ÂÖ≥Èó≠Ê∑ªÂä†Áî®Êà∑Ê®°ÊÄÅÊ°Ü
        function closeAddUserModal() {
            document.getElementById('addUserModal').classList.remove('show');
            document.getElementById('addUserForm').reset();
        }

        // Ê∑ªÂä†Áî®Êà∑
        async function addUser() {
            const username = document.getElementById('newUserUsername').value;
            const email = document.getElementById('newUserEmail').value;
            const password = document.getElementById('newUserPassword').value;
            const passwordConfirm = document.getElementById('newUserPasswordConfirm').value;
            const role = document.getElementById('newUserRole').value;
            
            // È™åËØÅËæìÂÖ•
            if (!username || !email || !password) {
                utils.showMessage('ËØ∑Â°´ÂÜôÊâÄÊúâÂøÖÂ°´Â≠óÊÆµ', 'error');
                return;
            }
            
            if (password !== passwordConfirm) {
                utils.showMessage('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥', 'error');
                return;
            }
            
            if (password.length < 6) {
                utils.showMessage('ÂØÜÁ†ÅÈïøÂ∫¶‰∏çËÉΩÂ∞ë‰∫é6‰Ωç', 'error');
                return;
            }
            
            try {
                await api.post('/api/admin/users', {
                    username, email, password, role
                });
                
                utils.showMessage('Áî®Êà∑Ê∑ªÂä†ÊàêÂäü', 'success');
                closeAddUserModal();
                loadUsers();
                
            } catch (error) {
                utils.showMessage(error.message || 'Ê∑ªÂä†Â§±Ë¥•', 'error');
            }
        }

        // ÁºñËæëÁî®Êà∑
        async function editUser(id) {
            try {
                const user = users.find(u => u.id === id);
                if (!user) return;
                
                document.getElementById('editUserId').value = user.id;
                document.getElementById('editUserUsername').value = user.username;
                document.getElementById('editUserEmail').value = user.email;
                document.getElementById('editUserRole').value = user.role;
                document.getElementById('editUserPassword').value = '';
                document.getElementById('editUserPasswordConfirm').value = '';
                
                document.getElementById('editUserModal').classList.add('show');
                
            } catch (error) {
                utils.showMessage(error.message || 'Ëé∑ÂèñÁî®Êà∑‰ø°ÊÅØÂ§±Ë¥•', 'error');
            }
        }

        // ÂÖ≥Èó≠ÁºñËæëÁî®Êà∑Ê®°ÊÄÅÊ°Ü
        function closeEditUserModal() {
            document.getElementById('editUserModal').classList.remove('show');
            document.getElementById('editUserForm').reset();
        }

        // Êõ¥Êñ∞Áî®Êà∑
        async function updateUser() {
            const id = document.getElementById('editUserId').value;
            const username = document.getElementById('editUserUsername').value;
            const email = document.getElementById('editUserEmail').value;
            const password = document.getElementById('editUserPassword').value;
            const passwordConfirm = document.getElementById('editUserPasswordConfirm').value;
            const role = document.getElementById('editUserRole').value;
            
            // È™åËØÅËæìÂÖ•
            if (!username || !email) {
                utils.showMessage('Áî®Êà∑ÂêçÂíåÈÇÆÁÆ±‰∏çËÉΩ‰∏∫Á©∫', 'error');
                return;
            }
            
            // Â¶ÇÊûúËæìÂÖ•‰∫ÜÂØÜÁ†ÅÔºåÈ™åËØÅÂØÜÁ†Å
            if (password && password !== passwordConfirm) {
                utils.showMessage('‰∏§Ê¨°ËæìÂÖ•ÁöÑÂØÜÁ†Å‰∏ç‰∏ÄËá¥', 'error');
                return;
            }
            
            if (password && password.length < 6) {
                utils.showMessage('ÂØÜÁ†ÅÈïøÂ∫¶‰∏çËÉΩÂ∞ë‰∫é6‰Ωç', 'error');
                return;
            }
            
            try {
                const updateData = { username, email, role };
                if (password) {
                    updateData.password = password;
                }
                
                await api.put(`/api/admin/users/${id}`, updateData);
                
                utils.showMessage('Áî®Êà∑Êõ¥Êñ∞ÊàêÂäü', 'success');
                closeEditUserModal();
                loadUsers();
                
            } catch (error) {
                utils.showMessage(error.message || 'Êõ¥Êñ∞Â§±Ë¥•', 'error');
            }
        }

        // Âà†Èô§Áî®Êà∑
        async function deleteUser(id, username) {
            if (!confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§Áî®Êà∑"${username}"ÂêóÔºüÊ≠§Êìç‰Ωú‰∏çÂèØÊí§ÈîÄ„ÄÇ`)) {
                return;
            }
            
            try {
                await api.delete(`/api/admin/users/${id}`);
                utils.showMessage('Áî®Êà∑Âà†Èô§ÊàêÂäü', 'success');
                loadUsers();
                
            } catch (error) {
                utils.showMessage(error.message || 'Âà†Èô§Â§±Ë¥•', 'error');
            }
        }

        // È°µÈù¢ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            loadCurrencies();
            loadCategories();
            loadUsers();
            refreshDatabaseStats();
            
            // ÁÇπÂáªÂÖ∂‰ªñÂú∞ÊñπÂÖ≥Èó≠Áî®Êà∑ËèúÂçï
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.user-menu')) {
                    const dropdown = document.getElementById('userDropdown');
                    dropdown.classList.remove('show');
                }
            });

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            document.getElementById('addCurrencyModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddCurrencyModal();
                }
            });

            document.getElementById('addCategoryModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddCategoryModal();
                }
            });

            document.getElementById('addUserModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeAddUserModal();
                }
            });

            document.getElementById('editUserModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditUserModal();
                }
            });

            document.getElementById('editCurrencyModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditCurrencyModal();
                }
            });

            document.getElementById('editCategoryModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeEditCategoryModal();
                }
            });

            // Êï∞ÊçÆÂ∫ìÁÆ°ÁêÜÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            document.getElementById('clearDatabaseModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeClearDatabaseModal();
                }
            });

            document.getElementById('resetDatabaseModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeResetDatabaseModal();
                }
            });

            // Ë°®ÂçïÈ™åËØÅ - Ê∏ÖÁ©∫Êï∞ÊçÆÂ∫ì
            const clearConfirmation = document.getElementById('clearConfirmation');
            const clearPassword = document.getElementById('clearAdminPassword');
            const clearBtn = document.getElementById('clearDatabaseBtn');

            function validateClearForm() {
                const isValid = clearConfirmation.value === 'CLEAR ALL DATA' && clearPassword.value.trim() !== '';
                clearBtn.disabled = !isValid;
            }

            clearConfirmation.addEventListener('input', validateClearForm);
            clearPassword.addEventListener('input', validateClearForm);

            // Ë°®ÂçïÈ™åËØÅ - ÈáçÁΩÆÊï∞ÊçÆÂ∫ì
            const resetConfirmation = document.getElementById('resetConfirmation');
            const resetPassword = document.getElementById('resetAdminPassword');
            const resetBtn = document.getElementById('resetDatabaseBtn');

            function validateResetForm() {
                const isValid = resetConfirmation.value === 'RESET TO DEFAULTS' && resetPassword.value.trim() !== '';
                resetBtn.disabled = !isValid;
            }

            resetConfirmation.addEventListener('input', validateResetForm);
            resetPassword.addEventListener('input', validateResetForm);
        });
    </script>
</body>
</html>